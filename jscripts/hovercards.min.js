!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):r.ColorThief=e()}(this,function(){if(!r)var r={map:function(r,e){var t={};return e?r.map(function(r,o){return t.index=o,e.call(t,r)}):r.slice()},naturalOrder:function(r,e){return r<e?-1:r>e?1:0},sum:function(r,e){var t={};return r.reduce(e?function(r,o,n){return t.index=n,r+e.call(t,o)}:function(r,e){return r+e},0)},max:function(e,t){return Math.max.apply(null,t?r.map(e,t):e)}};var e=function(){var e=5,t=8-e,o=1e3;function n(r,t,o){return(r<<2*e)+(t<<e)+o}function i(r){var e=[],t=!1;function o(){e.sort(r),t=!0}return{push:function(r){e.push(r),t=!1},peek:function(r){return t||o(),void 0===r&&(r=e.length-1),e[r]},pop:function(){return t||o(),e.pop()},size:function(){return e.length},map:function(r){return e.map(r)},debug:function(){return t||o(),e}}}function a(r,e,t,o,n,i,a){this.r1=r,this.r2=e,this.g1=t,this.g2=o,this.b1=n,this.b2=i,this.histo=a}function s(){this.vboxes=new i(function(e,t){return r.naturalOrder(e.vbox.count()*e.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function u(e,t){if(t.count()){var o=t.r2-t.r1+1,i=t.g2-t.g1+1,a=r.max([o,i,t.b2-t.b1+1]);if(1==t.count())return[t.copy()];var s,u,c,d,l=0,v=[],h=[];if(a==o)for(s=t.r1;s<=t.r2;s++){for(d=0,u=t.g1;u<=t.g2;u++)for(c=t.b1;c<=t.b2;c++)d+=e[n(s,u,c)]||0;v[s]=l+=d}else if(a==i)for(s=t.g1;s<=t.g2;s++){for(d=0,u=t.r1;u<=t.r2;u++)for(c=t.b1;c<=t.b2;c++)d+=e[n(u,s,c)]||0;v[s]=l+=d}else for(s=t.b1;s<=t.b2;s++){for(d=0,u=t.r1;u<=t.r2;u++)for(c=t.g1;c<=t.g2;c++)d+=e[n(u,c,s)]||0;v[s]=l+=d}return v.forEach(function(r,e){h[e]=l-r}),function(r){var e,o,n,i,a,u=r+"1",c=r+"2",d=0;for(s=t[u];s<=t[c];s++)if(v[s]>l/2){for(n=t.copy(),i=t.copy(),a=(e=s-t[u])<=(o=t[c]-s)?Math.min(t[c]-1,~~(s+o/2)):Math.max(t[u],~~(s-1-e/2));!v[a];)a++;for(d=h[a];!d&&v[a-1];)d=h[--a];return n[c]=a,i[u]=n[c]+1,[n,i]}}(a==o?"r":a==i?"g":"b")}}return a.prototype={volume:function(r){return this._volume&&!r||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(r){var e=this.histo;if(!this._count_set||r){var t,o,i,a=0;for(t=this.r1;t<=this.r2;t++)for(o=this.g1;o<=this.g2;o++)for(i=this.b1;i<=this.b2;i++)a+=e[n(t,o,i)]||0;this._count=a,this._count_set=!0}return this._count},copy:function(){return new a(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(r){var t=this.histo;if(!this._avg||r){var o,i,a,s,u=0,c=1<<8-e,d=0,l=0,v=0;for(i=this.r1;i<=this.r2;i++)for(a=this.g1;a<=this.g2;a++)for(s=this.b1;s<=this.b2;s++)u+=o=t[n(i,a,s)]||0,d+=o*(i+.5)*c,l+=o*(a+.5)*c,v+=o*(s+.5)*c;this._avg=u?[~~(d/u),~~(l/u),~~(v/u)]:[~~(c*(this.r1+this.r2+1)/2),~~(c*(this.g1+this.g2+1)/2),~~(c*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(r){var e=r[0]>>t;return gval=r[1]>>t,bval=r[2]>>t,e>=this.r1&&e<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},s.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var e=this.vboxes,t=0;t<e.size();t++)if(e.peek(t).vbox.contains(r))return e.peek(t).color;return this.nearest(r)},nearest:function(r){for(var e,t,o,n=this.vboxes,i=0;i<n.size();i++)((t=Math.sqrt(Math.pow(r[0]-n.peek(i).color[0],2)+Math.pow(r[1]-n.peek(i).color[1],2)+Math.pow(r[2]-n.peek(i).color[2],2)))<e||void 0===e)&&(e=t,o=n.peek(i).color);return o},forcebw:function(){var e=this.vboxes;e.sort(function(e,t){return r.naturalOrder(r.sum(e.color),r.sum(t.color))});var t=e[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(e[0].color=[0,0,0]);var o=e.length-1,n=e[o].color;n[0]>251&&n[1]>251&&n[2]>251&&(e[o].color=[255,255,255])}},{quantize:function(c,d){if(!c.length||d<2||d>256)return!1;var l=function(r){var o,i=new Array(1<<3*e);return r.forEach(function(r){o=n(r[0]>>t,r[1]>>t,r[2]>>t),i[o]=(i[o]||0)+1}),i}(c);l.forEach(function(){});var v=function(r,e){var o,n,i,s=1e6,u=0,c=1e6,d=0,l=1e6,v=0;return r.forEach(function(r){(o=r[0]>>t)<s?s=o:o>u&&(u=o),(n=r[1]>>t)<c?c=n:n>d&&(d=n),(i=r[2]>>t)<l?l=i:i>v&&(v=i)}),new a(s,u,c,d,l,v,e)}(c,l),h=new i(function(e,t){return r.naturalOrder(e.count(),t.count())});function f(r,e){for(var t,n=r.size(),i=0;i<o;){if(n>=e)return;if(i++>o)return;if((t=r.pop()).count()){var a=u(l,t),s=a[0],c=a[1];if(!s)return;r.push(s),c&&(r.push(c),n++)}else r.push(t),i++}}h.push(v),f(h,.75*d);for(var p=new i(function(e,t){return r.naturalOrder(e.count()*e.volume(),t.count()*t.volume())});h.size();)p.push(h.pop());f(p,d);for(var g=new s;p.size();)g.push(p.pop());return g}}}().quantize,t=function(r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=r.width,this.height=this.canvas.height=r.height,this.context.drawImage(r,0,0,this.width,this.height)};t.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var o=function(){};return o.prototype.getColor=function(r,e){return void 0===e&&(e=10),this.getPalette(r,5,e)[0]},o.prototype.getPalette=function(r,o,n){var i=function(r){var e=r.colorCount,t=r.quality;if(void 0!==e&&Number.isInteger(e)){if(1===e)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");e=Math.max(e,2),e=Math.min(e,20)}else e=10;return void 0===t||Number.isInteger(t)?t=10:t<1&&(t=10),{colorCount:e,quality:t}}({colorCount:o,quality:n}),a=new t(r),s=function(r,e,t){for(var o=r,n=[],i=0,a=void 0,s=void 0,u=void 0,c=void 0,d=void 0;i<e;i+=t)s=o[0+(a=4*i)],u=o[a+1],c=o[a+2],(void 0===(d=o[a+3])||d>=125)&&(s>250&&u>250&&c>250||n.push([s,u,c]));return n}(a.getImageData().data,a.width*a.height,i.quality),u=e(s,i.colorCount);return u?u.palette():null},o.prototype.getColorFromUrl=function(r,e,t){var o=document.createElement("img"),n=this;o.addEventListener("load",function(){var i=n.getPalette(o,5,t);e(i[0],r)}),o.src=r},o.prototype.getImageData=function(r,e){var t=new XMLHttpRequest;t.open("GET",r,!0),t.responseType="arraybuffer",t.onload=function(){if(200==this.status){var r=new Uint8Array(this.response);o=r.length;for(var t=new Array(o),o=0;o<r.length;o++)t[o]=String.fromCharCode(r[o]);var n=t.join(""),i=window.btoa(n);e("data:image/png;base64,"+i)}},t.send()},o.prototype.getColorAsync=function(r,e,t){var o=this;this.getImageData(r,function(r){var n=document.createElement("img");n.addEventListener("load",function(){var r=o.getPalette(n,5,t);e(r[0],this)}),n.src=r})},o}),$.fn.afterTransition=function(r){return this.each(function(){$(this).bind("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd transitionend webkitTransitionEAnind oTransitionEnd MSTransitionEnd",function(){"function"==typeof r&&r.call(this)})})};var Hovercards={drops:[],usersCache:{},uid:null,inTimeout:null,outTimeout:null,counter:0,delays:{appear:.4,disappear:1},template:null,init:function(r){if(Hovercards.utilities.isTouchDevice())return!1;this.options=$.extend({backgroundColor:null,dropPosition:"bottom left"},r),$(document).on("click","a[data-uid]",function(){if(!$(this).closest(".drop").length)return Hovercards.isActive=!1,Hovercards.visibilityHandler.hideAllHovercards()}),$(document).on("mouseenter","[data-uid]",function(){if($(this).closest(".drop").length)return!1;if(Hovercards.isActive=!0,null!==Hovercards.outTimeout&&clearTimeout(Hovercards.outTimeout),$(this).hasClass("drop-enabled"))return!1;var r=this;Hovercards.inTimeout=setTimeout(function(){var e=$(r);Hovercards.counter++,Hovercards.uid=e.attr("data-uid"),Hovercards.visibilityHandler.hideAllHovercards();var t,o=r,n=Hovercards.usersHandler.getCurrentUser();if(e.data("hovercard",Hovercards.counter),!Hovercards.exists(n)){var i=[];$("[data-uid]").each(function(){var r=$(this).attr("data-uid"),e=parseInt(r);if($.isNumeric(r)&&r>0&&i.indexOf(e)<0&&!Hovercards.exists(Hovercards.usersCache[e]))return i.push(e)}),i&&(t=$.ajax("xmlhttp.php",{data:{action:"hovercards",uids:i}}))}$.when(t).then(function(r){Hovercards.exists(r)&&$.each(r,function(r,e){return Hovercards.usersHandler.saveUserInCache(e)}),$.when(Hovercards.colorHandler.getDominantColor()).then(function(){return Hovercards.visibilityHandler.showHovercard(o,Hovercards.buildTemplate())})})},1e3*Hovercards.delays.appear)}).on("mouseenter",".drop-element",function(r){if(null!==Hovercards.outTimeout)return clearTimeout(Hovercards.outTimeout)}).on("mouseleave",".drop-element, *[data-uid]",function(r){var e=$(this).data("hovercard")?$(this).data("hovercard"):Hovercards.counter;null!==Hovercards.inTimeout&&clearTimeout(Hovercards.inTimeout),Hovercards.outTimeout=setTimeout(function(){var t=r.relatedTarget?$(r.relatedTarget):$(r.toElement),o=t.attr("class");return(!Hovercards.exists(t)||!(Hovercards.exists(o)&&o.match(/\b(drop-element|drop-target)\b/)||t.parents(".drop-element, .drop-target").length>0))&&Hovercards.visibilityHandler.hideHovercard(e)},1e3*Hovercards.delays.disappear)})},buildTemplateCallback:function(r,e){return r},buildTemplate:function(){var r=Hovercards.usersHandler.getCurrentUser();if(!r)return!1;var e=Hovercards.template;return e=Hovercards.buildTemplateCallback(e,r)},visibilityHandler:{showHovercard:function(r,e){if(!Hovercards.isActive||parseInt($(r).data("hovercard"))!=Hovercards.counter)return!1;var t=Hovercards.counter;$(r).removeClass(function(r,e){return(e.match(/(^|\s)drop-number-\S+/g)||[]).join(" ")}),Hovercards.drops[t]=new Drop({target:r,content:e,position:Hovercards.options.dropPosition,classes:"drop-theme-hubspot-popovers drop-number-"+Hovercards.counter,openOn:"always"});var o=Hovercards.options.backgroundColor?"#"+Hovercards.options.backgroundColor:Hovercards.usersHandler.getCurrentUserProperty("dominant");if(Hovercards.options.dropPosition.indexOf("center")<0){Hovercards.drops[t].on("open",()=>(function(r){let e=r.drop.getBoundingClientRect().width,t=r.target.getBoundingClientRect().left,o=$(window).width()-t,n=e>o?"right":"left";r.tether.attachment.left=n,r.tether.targetAttachment.left=n,r.position()})(Hovercards.drops[t]))}if(Hovercards.drops[t].position(),Hovercards.drops[t].open(),$(".drop-number-"+t).data("hovercard",t),Hovercards.drops[t].tether.on("repositioned",function(){var r=$(this.element).hasClass("drop-target-attached-bottom")?"bottom":"top";if(r==this.hovercardsArrowPosition)return!1;this.hovercardsArrowPosition=r;var e=Hovercards.options.backgroundColor?"#"+Hovercards.options.backgroundColor:Hovercards.colorHandler.getNormalizedColor(Hovercards.usersHandler.getCurrentUserProperty("dominant"));return Hovercards.colorHandler.updateArrowColorAndPositioning(r,e,t)}),o){var n=Hovercards.colorHandler.getComplementaryTextColor(o),i=$(Hovercards.drops[t].content),a=Hovercards.options.backgroundColor?o:Hovercards.colorHandler.getNormalizedColor(o);i.css("background",a),i.css("color",n)}if(a){var s=$(Hovercards.drops[t].drop).hasClass("drop-target-attached-bottom")?"bottom":"top";Hovercards.drops[t].tether.hovercardsArrowPosition=s,Hovercards.colorHandler.updateArrowColorAndPositioning(s,a)}},hideAllHovercards:function(){if(Hovercards.inTimeout&&clearTimeout(Hovercards.inTimeout),Hovercards.drops)for(var r in Hovercards.drops)Hovercards.drops.hasOwnProperty(r)&&Hovercards.visibilityHandler.hideHovercard(r)},hideHovercard:function(r){var e=Hovercards.drops[r];if(!Hovercards.exists(e))return!1;e.close();var t=function(){if(Hovercards.exists(e.drop))try{e.destroy()}catch(r){}Hovercards.colorHandler.deleteArrowColorAndPositioning(r)};return $(e.drop).afterTransition(t),setTimeout(t,500),Hovercards.drops.splice(r,1)}},usersHandler:{saveUserInCache:function(r){return!!Hovercards.exists(r.uid)&&(Hovercards.usersCache[r.uid]=r,!0)},saveUserPropertyInCache:function(r,e){return!!Hovercards.exists(Hovercards.uid)&&(Hovercards.usersCache[Hovercards.uid][r]=e,!0)},deleteUserFromCache:function(r){return Hovercards.usersCache.splice(r,1)},getUser:function(r){return Hovercards.usersCache[r]?Hovercards.usersCache[r]:null},getUserProperty:function(r,e){var t=Hovercards.usersHandler.getCurrentUser();return Hovercards.exists(t)&&Hovercards.exists(t[e])?t[e]:null},getCurrentUser:function(){return Hovercards.usersHandler.getUser(Hovercards.uid)},getCurrentUserProperty:function(r){return Hovercards.usersHandler.getUserProperty(Hovercards.uid,r)}},colorHandler:{getDominantColor:function(){return $.Deferred(function(){var r=this,e=Hovercards.usersHandler.getCurrentUser();if(!Hovercards.exists(e)||Hovercards.exists(e.dominant)||!Hovercards.exists(e.avatar)||Hovercards.options.backgroundColor)return r.resolve();var t=new Image;t.crossOrigin="anonymous",e.avatar.indexOf("http")>-1?t.src="https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&refresh=300&url="+encodeURIComponent(e.avatar):t.src=e.avatar,$(t).one("load",function(){var e=new ColorThief;return Hovercards.usersHandler.saveUserPropertyInCache("dominant",e.getColor(t)),r.resolve()})})},getComplementaryTextColor:function(r){return(299*r[0]+587*r[1]+114*r[2])/1e3>=160?"rgba(0,0,0,.66)":"#fff"},getNormalizedColor:function(r){return"rgb("+r.join(", ")+")"},updateArrowColorAndPositioning:function(r,e,t){return t?$("#drop-arrow-"+t).replaceWith($('<style type="text/css" id="drop-arrow-'+t+'">.drop-number-'+t+" .drop-content::before {border-"+r+"-color: "+e+"!important}</style>")):$("body").append($('<style type="text/css" id="drop-arrow-'+Hovercards.counter+'">.drop-number-'+Hovercards.counter+" .drop-content::before {border-"+r+"-color: "+e+"!important}</style>"))},deleteArrowColorAndPositioning:function(r){return $("#drop-arrow-"+r).remove()}},utilities:{isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},processDateline:function(r,e){if(!r||!Hovercards.exists(r))return!1;var t=new Date(1e3*r),o=(new Date).setHours(0,0,0,0)/1e3;if(r>o-86400&&r<o)return"Yesterday";if(r>o){var n=Math.round((new Date-t)/1e3);return n<900&&"lastactive"==e?"Online":n<30?"Just now":n<60?n+" seconds ago":n<120?"A minute ago":n<3600?Math.floor(n/60)+" minutes ago":1==Math.floor(n/3600)?"1 hour ago":n<86400?Math.floor(n/3600)+" hours ago":"Today"}var i=t.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],a=t.getUTCFullYear();return(new Date).getUTCFullYear()!=a&&(i+=" "+a),i}},exists:function(r){return!(void 0===r||null==r||!r)}};