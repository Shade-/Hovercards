var CanvasImage=function(q){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=q.width,this.height=this.canvas.height=q.height,this.context.drawImage(q,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(q){this.context.putImageData(q,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(q,r){var s=this.getPalette(q,5,r),t=s[0];return t},ColorThief.prototype.getPalette=function(q,r,s){"undefined"==typeof r&&(r=10),("undefined"==typeof s||1>s)&&(s=10);for(var t,u,w,x,y,z=new CanvasImage(q),A=z.getImageData(),B=A.data,C=z.getPixelCount(),D=[],E=0;C>E;E+=s)t=4*E,u=B[t+0],w=B[t+1],x=B[t+2],y=B[t+3],125<=y&&(250<u&&250<w&&250<x||D.push([u,w,x]));var F=MMCQ.quantize(D,r),G=F?F.palette():null;return z.removeCanvas(),G},!pv)var pv={map:function(q,r){var s={};return r?q.map(function(t,u){return s.index=u,r.call(s,t)}):q.slice()},naturalOrder:function(q,r){return r>q?-1:q>r?1:0},sum:function(q,r){var s={};return q.reduce(r?function(t,u,w){return s.index=w,t+r.call(s,u)}:function(t,u){return t+u},0)},max:function(q,r){return Math.max.apply(null,r?pv.map(q,r):q)}};var MMCQ=function(){function q(D,E,F){return(D<<2*z)+(E<<z)+F}function r(D){function E(){F.sort(D),G=!0}var F=[],G=!1;return{push:function(H){F.push(H),G=!1},peek:function(H){return G||E(),void 0===H&&(H=F.length-1),F[H]},pop:function(){return G||E(),F.pop()},size:function(){return F.length},map:function(H){return F.map(H)},debug:function(){return G||E(),F}}}function s(D,E,F,G,H,I,J){var K=this;K.r1=D,K.r2=E,K.g1=F,K.g2=G,K.b1=H,K.b2=I,K.histo=J}function t(){this.vboxes=new r(function(D,E){return pv.naturalOrder(D.vbox.count()*D.vbox.volume(),E.vbox.count()*E.vbox.volume())})}function u(D){var E,F,G,H,J=Array(1<<3*z);return D.forEach(function(K){F=K[0]>>A,G=K[1]>>A,H=K[2]>>A,E=q(F,G,H),J[E]=(J[E]||0)+1}),J}function w(D,E){var F,G,H,I=1e6,J=0,K=1e6,L=0,M=1e6,N=0;return D.forEach(function(O){F=O[0]>>A,G=O[1]>>A,H=O[2]>>A,I>F?I=F:F>J&&(J=F),K>G?K=G:G>L&&(L=G),M>H?M=H:H>N&&(N=H)}),new s(I,J,K,L,M,N,E)}function x(D,E){function F(S){var T,U,V,W,X,Y=S+"1",Z=S+"2",_=0;for(K=E[Y];K<=E[Z];K++)if(Q[K]>P/2){for(V=E.copy(),W=E.copy(),T=K-E[Y],U=E[Z]-K,X=U>=T?Math.min(E[Z]-1,~~(K+U/2)):Math.max(E[Y],~~(K-1-T/2));!Q[X];)X++;for(_=R[X];!_&&Q[X-1];)_=R[--X];return V[Z]=X,W[Y]=V[Z]+1,[V,W]}}if(E.count()){var G=E.r2-E.r1+1,H=E.g2-E.g1+1,I=E.b2-E.b1+1,J=pv.max([G,H,I]);if(1==E.count())return[E.copy()];var K,L,M,N,O,P=0,Q=[],R=[];if(J==G)for(K=E.r1;K<=E.r2;K++){for(N=0,L=E.g1;L<=E.g2;L++)for(M=E.b1;M<=E.b2;M++)O=q(K,L,M),N+=D[O]||0;P+=N,Q[K]=P}else if(J==H)for(K=E.g1;K<=E.g2;K++){for(N=0,L=E.r1;L<=E.r2;L++)for(M=E.b1;M<=E.b2;M++)O=q(L,K,M),N+=D[O]||0;P+=N,Q[K]=P}else for(K=E.b1;K<=E.b2;K++){for(N=0,L=E.r1;L<=E.r2;L++)for(M=E.g1;M<=E.g2;M++)O=q(L,M,K),N+=D[O]||0;P+=N,Q[K]=P}return Q.forEach(function(S,T){R[T]=P-S}),F(J==G?"r":J==H?"g":"b")}}var z=5,A=8-z,B=1e3;return s.prototype={volume:function(D){var E=this;return(!E._volume||D)&&(E._volume=(E.r2-E.r1+1)*(E.g2-E.g1+1)*(E.b2-E.b1+1)),E._volume},count:function(D){var E=this,F=E.histo;if(!E._count_set||D){var G,H,I,J=0;for(G=E.r1;G<=E.r2;G++)for(H=E.g1;H<=E.g2;H++)for(I=E.b1;I<=E.b2;I++)index=q(G,H,I),J+=F[index]||0;E._count=J,E._count_set=!0}return E._count},copy:function(){var D=this;return new s(D.r1,D.r2,D.g1,D.g2,D.b1,D.b2,D.histo)},avg:function(D){var E=this,F=E.histo;if(!E._avg||D){var G,H,I,J,K,L=0,M=1<<8-z,N=0,O=0,P=0;for(H=E.r1;H<=E.r2;H++)for(I=E.g1;I<=E.g2;I++)for(J=E.b1;J<=E.b2;J++)K=q(H,I,J),G=F[K]||0,L+=G,N+=G*(H+.5)*M,O+=G*(I+.5)*M,P+=G*(J+.5)*M;E._avg=L?[~~(N/L),~~(O/L),~~(P/L)]:[~~(M*(E.r1+E.r2+1)/2),~~(M*(E.g1+E.g2+1)/2),~~(M*(E.b1+E.b2+1)/2)]}return E._avg},contains:function(D){var E=this,F=D[0]>>A;return gval=D[1]>>A,bval=D[2]>>A,F>=E.r1&&F<=E.r2&&gval>=E.g1&&gval<=E.g2&&bval>=E.b1&&bval<=E.b2}},t.prototype={push:function(D){this.vboxes.push({vbox:D,color:D.avg()})},palette:function(){return this.vboxes.map(function(D){return D.color})},size:function(){return this.vboxes.size()},map:function(D){for(var E=this.vboxes,F=0;F<E.size();F++)if(E.peek(F).vbox.contains(D))return E.peek(F).color;return this.nearest(D)},nearest:function(D){for(var E,F,G,H=this.vboxes,I=0;I<H.size();I++)F=Math.sqrt(Math.pow(D[0]-H.peek(I).color[0],2)+Math.pow(D[1]-H.peek(I).color[1],2)+Math.pow(D[2]-H.peek(I).color[2],2)),(E>F||void 0===E)&&(E=F,G=H.peek(I).color);return G},forcebw:function(){var D=this.vboxes;D.sort(function(H,I){return pv.naturalOrder(pv.sum(H.color),pv.sum(I.color))});var E=D[0].color;5>E[0]&&5>E[1]&&5>E[2]&&(D[0].color=[0,0,0]);var F=D.length-1,G=D[F].color;251<G[0]&&251<G[1]&&251<G[2]&&(D[F].color=[255,255,255])}},{quantize:function(D,E){function F(M,N){for(var O,P=1,Q=0;B>Q;)if(O=M.pop(),O.count()){var R=x(G,O),S=R[0],T=R[1];if(!S)return;if(M.push(S),T&&(M.push(T),P++),P>=N)return;if(Q++>B)return}else M.push(O),Q++}if(!D.length||2>E||256<E)return!1;var G=u(D),H=0;G.forEach(function(){H++});var I=w(D,G),J=new r(function(M,N){return pv.naturalOrder(M.count(),N.count())});J.push(I),F(J,.75*E);for(var K=new r(function(M,N){return pv.naturalOrder(M.count()*M.volume(),N.count()*N.volume())});J.size();)K.push(J.pop());F(K,E-K.size());for(var L=new t;K.size();)L.push(K.pop());return L}}}();$.fn.afterTransition=function(q){return this.each(function(){var r=$(this);r.bind("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd transitionend webkitTransitionEAnind oTransitionEnd MSTransitionEnd",function(){"function"==typeof q&&q.call(this)})})};var Hovercards={drops:[],usersCache:{},uid:null,inTimeout:null,outTimeout:null,counter:0,delays:{appear:0.4,disappear:1},template:null,init:function(q){return!Hovercards.utilities.isTouchDevice()&&void(this.options=$.extend({backgroundColor:null,dropPosition:"bottom left"},q),$("body").on("click","a[data-uid]",function(){if(!$(this).closest(".drop").length)return Hovercards.isActive=!1,Hovercards.visibilityHandler.hideAllHovercards()}),$("body").on("mouseenter","a[data-uid]",function(){if($(this).closest(".drop").length)return!1;if(Hovercards.isActive=!0,null!==Hovercards.outTimeout&&clearTimeout(Hovercards.outTimeout),$(this).hasClass("drop-enabled"))return!1;var r=this;Hovercards.inTimeout=setTimeout(function(){var s=$(r);Hovercards.counter++,Hovercards.uid=s.attr("data-uid"),Hovercards.visibilityHandler.hideAllHovercards();var w,u=Hovercards.usersHandler.getCurrentUser();if(s.data("hovercard",Hovercards.counter),!Hovercards.exists(u)){var x=[];$("[data-uid]").each(function(){var y=$(this).attr("data-uid"),z=parseInt(y);if($.isNumeric(y)&&0<y&&0>x.indexOf(z)&&!Hovercards.exists(Hovercards.usersCache[z]))return x.push(z)}),w=$.ajax("xmlhttp.php",{data:{action:"hovercards",uids:x}})}$.when(w).then(function(y){Hovercards.exists(y)&&$.each($.parseJSON(y),function(z,A){return Hovercards.usersHandler.saveUserInCache(A)}),$.when(Hovercards.colorHandler.getDominantColor()).then(function(){return Hovercards.visibilityHandler.showHovercard(r,Hovercards.buildTemplate())})})},1e3*Hovercards.delays.appear)}).on("mouseenter",".drop-element",function(){if(null!==Hovercards.outTimeout)return clearTimeout(Hovercards.outTimeout)}).on("mouseleave",".drop-element, *[data-uid]",function(r){var s=$(this).data("hovercard")?$(this).data("hovercard"):Hovercards.counter;null!==Hovercards.inTimeout&&clearTimeout(Hovercards.inTimeout),Hovercards.outTimeout=setTimeout(function(){var t=r.relatedTarget?$(r.relatedTarget):$(r.toElement),u=t.attr("class");return Hovercards.exists(t)&&(Hovercards.exists(u)&&u.match(/\b(drop-element|drop-target)\b/)||0<t.parents(".drop-element, .drop-target").length)?!1:Hovercards.visibilityHandler.hideHovercard(s)},1e3*Hovercards.delays.disappear)}))},buildTemplate:function(){var q=Hovercards.usersHandler.getCurrentUser();if(!q)return!1;var r=Hovercards.template;return $.each(q,function(s,t){$.isNumeric(t)&&10==t.length&&(t=Hovercards.utilities.processDateline(t,s)),r=r.replace(new RegExp("{"+s+"}","g"),t)}),r},visibilityHandler:{showHovercard:function(q,r){if(!Hovercards.isActive||parseInt($(q).data("hovercard"))!=Hovercards.counter)return!1;var s=Hovercards.counter;$(q).removeClass(function(z,A){return(A.match(/(^|\s)drop-number-\S+/g)||[]).join(" ")}),Hovercards.drops[s]=new Drop({target:q,content:r,position:Hovercards.options.dropPosition,classes:"drop-theme-hubspot-popovers drop-number-"+Hovercards.counter,openOn:"always"});var t=Hovercards.options.backgroundColor?"#"+Hovercards.options.backgroundColor:Hovercards.usersHandler.getCurrentUserProperty("dominant");if(0>Hovercards.options.dropPosition.indexOf("center")){function z(A){let B=A.drop.getBoundingClientRect().width,C=A.target.getBoundingClientRect().left,D=$(window).width()-C,E=B>D?"right":"left";A.tether.attachment.left=E,A.tether.targetAttachment.left=E,A.position()}Hovercards.drops[s].on("open",()=>z(Hovercards.drops[s]))}if(Hovercards.drops[s].position(),Hovercards.drops[s].open(),$(".drop-number-"+s).data("hovercard",s),Hovercards.drops[s].tether.on("repositioned",function(){var z=$(this.element).hasClass("drop-target-attached-bottom")?"bottom":"top";if(z==this.hovercardsArrowPosition)return!1;this.hovercardsArrowPosition=z;var A=Hovercards.options.backgroundColor?"#"+Hovercards.options.backgroundColor:Hovercards.colorHandler.getNormalizedColor(Hovercards.usersHandler.getCurrentUserProperty("dominant"));return Hovercards.colorHandler.updateArrowColorAndPositioning(z,A,s)}),t){var u=Hovercards.colorHandler.getComplementaryTextColor(t),w=$(Hovercards.drops[s].content),x=Hovercards.options.backgroundColor?t:Hovercards.colorHandler.getNormalizedColor(t);w.css("background",x),w.css("color",u)}if(x){var y=$(Hovercards.drops[s].drop).hasClass("drop-target-attached-bottom")?"bottom":"top";Hovercards.drops[s].tether.hovercardsArrowPosition=y,Hovercards.colorHandler.updateArrowColorAndPositioning(y,x)}},hideAllHovercards:function(){if(Hovercards.inTimeout&&clearTimeout(Hovercards.inTimeout),Hovercards.drops)for(var q in Hovercards.drops)Hovercards.drops.hasOwnProperty(q)&&Hovercards.visibilityHandler.hideHovercard(q)},hideHovercard:function(q){var r=Hovercards.drops[q];if(!Hovercards.exists(r))return!1;r.close();var s=function(){if(Hovercards.exists(r.drop))try{r.destroy()}catch(t){}Hovercards.colorHandler.deleteArrowColorAndPositioning(q)};return $(r.drop).afterTransition(s),setTimeout(s,500),Hovercards.drops.splice(q,1)}},usersHandler:{saveUserInCache:function(q){return!!Hovercards.exists(q.uid)&&(Hovercards.usersCache[q.uid]=q,!0)},saveUserPropertyInCache:function(q,r){return!!Hovercards.exists(Hovercards.uid)&&(Hovercards.usersCache[Hovercards.uid][q]=r,!0)},deleteUserFromCache:function(q){return Hovercards.usersCache.splice(q,1)},getUser:function(q){return Hovercards.usersCache[q]?Hovercards.usersCache[q]:null},getUserProperty:function(q,r){var s=Hovercards.usersHandler.getCurrentUser();return Hovercards.exists(s)&&Hovercards.exists(s[r])?s[r]:null},getCurrentUser:function(){return Hovercards.usersHandler.getUser(Hovercards.uid)},getCurrentUserProperty:function(q){return Hovercards.usersHandler.getUserProperty(Hovercards.uid,q)}},colorHandler:{getDominantColor:function(){return $.Deferred(function(){var q=this,r=Hovercards.usersHandler.getCurrentUser();if(Hovercards.exists(r)&&!Hovercards.exists(r.dominant)&&Hovercards.exists(r.avatar)&&!Hovercards.options.backgroundColor){var s=new Image;s.crossOrigin="anonymous",s.src=-1<r.avatar.indexOf("http")?"https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&refresh=300&url="+encodeURIComponent(r.avatar):r.avatar,$(s).one("load",function(){var t=new ColorThief;return Hovercards.usersHandler.saveUserPropertyInCache("dominant",t.getColor(s)),q.resolve()})}else return q.resolve()})},getComplementaryTextColor:function(q){return 160<=(299*q[0]+587*q[1]+114*q[2])/1e3?"rgba(0,0,0,.66)":"#fff"},getNormalizedColor:function(q){return"rgb("+q.join(", ")+")"},updateArrowColorAndPositioning:function(q,r,s){return s?$("#drop-arrow-"+s).replaceWith($("<style type=\"text/css\" id=\"drop-arrow-"+s+"\">.drop-number-"+s+" .drop-content::before {border-"+q+"-color: "+r+"!important}</style>")):$("body").append($("<style type=\"text/css\" id=\"drop-arrow-"+Hovercards.counter+"\">.drop-number-"+Hovercards.counter+" .drop-content::before {border-"+q+"-color: "+r+"!important}</style>"))},deleteArrowColorAndPositioning:function(q){return $("#drop-arrow-"+q).remove()}},utilities:{isTouchDevice:function(){return"ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints},processDateline:function(q,r){if(!q||!Hovercards.exists(q))return!1;var s=new Date(1e3*q),u=new Date().setHours(0,0,0,0)/1e3;if(q>u-86400&&q<u)return"Yesterday";if(q>u){var B,x=Math.round((new Date-s)/1e3),y=60,z=60*y;return x<15*y&&"lastactive"==r?"Online":(B=30>x?"Just now":x<y?x+" seconds ago":x<2*y?"A minute ago":x<z?Math.floor(x/y)+" minutes ago":1==Math.floor(x/z)?"1 hour ago":x<24*z?Math.floor(x/z)+" hours ago":"Today",B)}var C=s.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s.getMonth()],D=s.getUTCFullYear();return new Date().getUTCFullYear()!=D&&(C+=" "+D),C}},exists:function(q){return"undefined"!=typeof q&&null!=q&&q}};