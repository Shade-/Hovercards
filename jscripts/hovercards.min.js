var CanvasImage=function(b){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=b.width,this.height=this.canvas.height=b.height,this.context.drawImage(b,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(b){this.context.putImageData(b,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(e,a){var b=this.getPalette(e,5,a),c=b[0];return c},ColorThief.prototype.getPalette=function(q,a,r){"undefined"==typeof a&&(a=10),("undefined"==typeof r||1>r)&&(r=10);for(var s,t,u,v,w,x=new CanvasImage(q),i=x.getImageData(),j=i.data,k=x.getPixelCount(),l=[],m=0;k>m;m+=r)s=4*m,t=j[s+0],u=j[s+1],v=j[s+2],w=j[s+3],125<=w&&(250<t&&250<u&&250<v||l.push([t,u,v]));var y=MMCQ.quantize(l,a),o=y?y.palette():null;return x.removeCanvas(),o},!pv)var pv={map:function(d,e){var b={};return e?d.map(function(c,a){return b.index=a,e.call(b,c)}):d.slice()},naturalOrder:function(c,a){return a>c?-1:c>a?1:0},sum:function(d,f){var b={};return d.reduce(f?function(c,a,d){return b.index=d,c+f.call(b,a)}:function(c,a){return c+a},0)},max:function(c,a){return Math.max.apply(null,a?pv.map(c,a):c)}};var MMCQ=function(){function n(d,a,b){return(d<<2*g)+(a<<g)+b}function q(e){function f(){b.sort(e),c=!0}var b=[],c=!1;return{push:function(d){b.push(d),c=!1},peek:function(d){return c||f(),void 0===d&&(d=b.length-1),b[d]},pop:function(){return c||f(),b.pop()},size:function(){return b.length},map:function(c){return b.map(c)},debug:function(){return c||f(),b}}}function o(i,a,b,c,d,e,f){var g=this;g.r1=i,g.r2=a,g.g1=b,g.g2=c,g.b1=d,g.b2=e,g.histo=f}function a(){this.vboxes=new q(function(c,a){return pv.naturalOrder(c.vbox.count()*c.vbox.volume(),a.vbox.count()*a.vbox.volume())})}function b(a){var i,j,k,l,m=Array(1<<3*g);return a.forEach(function(a){j=a[0]>>p,k=a[1]>>p,l=a[2]>>p,i=n(j,k,l),m[i]=(m[i]||0)+1}),m}function d(c,a){var b,j,n,q=1e6,r=0,s=1e6,t=0,u=1e6,v=0;return c.forEach(function(c){b=c[0]>>p,j=c[1]>>p,n=c[2]>>p,q>b?q=b:b>r&&(r=b),s>j?s=j:j>t&&(t=j),u>n?u=n:n>v&&(v=n)}),new o(q,r,s,t,u,v,a)}function m(a,q){function b(c){var a,i,l,m,n,p=c+"1",h=c+"2",j=0;for(r=q[p];r<=q[h];r++)if(v[r]>u/2){for(l=q.copy(),m=q.copy(),a=r-q[p],i=q[h]-r,n=i>=a?Math.min(q[h]-1,~~(r+i/2)):Math.max(q[p],~~(r-1-a/2));!v[n];)n++;for(j=o[n];!j&&v[n-1];)j=o[--n];return l[h]=n,m[p]=l[h]+1,[l,m]}}if(q.count()){var c=q.r2-q.r1+1,d=q.g2-q.g1+1,e=q.b2-q.b1+1,f=pv.max([c,d,e]);if(1==q.count())return[q.copy()];var r,g,h,s,t,u=0,v=[],o=[];if(f==c)for(r=q.r1;r<=q.r2;r++){for(s=0,g=q.g1;g<=q.g2;g++)for(h=q.b1;h<=q.b2;h++)t=n(r,g,h),s+=a[t]||0;u+=s,v[r]=u}else if(f==d)for(r=q.g1;r<=q.g2;r++){for(s=0,g=q.r1;g<=q.r2;g++)for(h=q.b1;h<=q.b2;h++)t=n(g,r,h),s+=a[t]||0;u+=s,v[r]=u}else for(r=q.b1;r<=q.b2;r++){for(s=0,g=q.r1;g<=q.r2;g++)for(h=q.g1;h<=q.g2;h++)t=n(g,h,r),s+=a[t]||0;u+=s,v[r]=u}return v.forEach(function(c,a){o[a]=u-c}),b(f==c?"r":f==d?"g":"b")}}function c(f,g){function c(g,a){for(var b,i=1,l=0;r>l;)if(b=g.pop(),b.count()){var n=m(k,b),f=n[0],h=n[1];if(!f)return;if(g.push(f),h&&(g.push(h),i++),i>=a)return;if(l++>r)return}else g.push(b),l++}if(!f.length||2>g||256<g)return!1;var k=b(f),h=0;k.forEach(function(){h++});var i=d(f,k),l=new q(function(c,a){return pv.naturalOrder(c.count(),a.count())});l.push(i),c(l,e*g);for(var n=new q(function(c,a){return pv.naturalOrder(c.count()*c.volume(),a.count()*a.volume())});l.size();)n.push(l.pop());c(n,g-n.size());for(var o=new a;n.size();)o.push(n.pop());return o}var g=5,p=3,r=1e3,e=.75;return o.prototype={volume:function(c){var a=this;return(!a._volume||c)&&(a._volume=(a.r2-a.r1+1)*(a.g2-a.g1+1)*(a.b2-a.b1+1)),a._volume},count:function(a){var b=this,c=b.histo;if(!b._count_set||a){var d,i,j,k=0;for(d=b.r1;d<=b.r2;d++)for(i=b.g1;i<=b.g2;i++)for(j=b.b1;j<=b.b2;j++)index=n(d,i,j),k+=c[index]||0;b._count=k,b._count_set=!0}return b._count},copy:function(){var b=this;return new o(b.r1,b.r2,b.g1,b.g2,b.b1,b.b2,b.histo)},avg:function(a){var b=this,c=b.histo;if(!b._avg||a){var d,i,l,p,q,r=0,s=0,t=0,u=0;for(i=b.r1;i<=b.r2;i++)for(l=b.g1;l<=b.g2;l++)for(p=b.b1;p<=b.b2;p++)q=n(i,l,p),d=c[q]||0,r+=d,s+=d*(i+.5)*8,t+=d*(l+.5)*8,u+=d*(p+.5)*8;b._avg=r?[~~(s/r),~~(t/r),~~(u/r)]:[~~(8*(b.r1+b.r2+1)/2),~~(8*(b.g1+b.g2+1)/2),~~(8*(b.b1+b.b2+1)/2)]}return b._avg},contains:function(d){var a=this,b=d[0]>>3;return gval=d[1]>>3,bval=d[2]>>3,b>=a.r1&&b<=a.r2&&gval>=a.g1&&gval<=a.g2&&bval>=a.b1&&bval<=a.b2}},a.prototype={push:function(b){this.vboxes.push({vbox:b,color:b.avg()})},palette:function(){return this.vboxes.map(function(b){return b.color})},size:function(){return this.vboxes.size()},map:function(d){for(var a=this.vboxes,b=0;b<a.size();b++)if(a.peek(b).vbox.contains(d))return a.peek(b).color;return this.nearest(d)},nearest:function(g){for(var a,h,i,j=this.vboxes,e=0;e<j.size();e++)h=Math.sqrt(Math.pow(g[0]-j.peek(e).color[0],2)+Math.pow(g[1]-j.peek(e).color[1],2)+Math.pow(g[2]-j.peek(e).color[2],2)),(a>h||void 0===a)&&(a=h,i=j.peek(e).color);return i},forcebw:function(){var e=this.vboxes;e.sort(function(c,a){return pv.naturalOrder(pv.sum(c.color),pv.sum(a.color))});var a=e[0].color;5>a[0]&&5>a[1]&&5>a[2]&&(e[0].color=[0,0,0]);var b=e.length-1,c=e[b].color;251<c[0]&&251<c[1]&&251<c[2]&&(e[b].color=[255,255,255])}},{quantize:c}}();$.fn.afterTransition=function(a){return this.each(function(){var b=$(this);b.bind("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd transitionend webkitTransitionEAnind oTransitionEnd MSTransitionEnd",function(){"function"==typeof a&&a.call(this)})})};var Hovercards={drops:[],usersCache:{},uid:null,inTimeout:null,outTimeout:null,counter:0,delays:{appear:.4,disappear:1},template:null,init:function(a){return!Hovercards.utilities.isTouchDevice()&&void(this.options=$.extend({backgroundColor:null,dropPosition:"bottom left"},a),$(document).on("click","a[data-uid]",function(){if(!$(this).closest(".drop").length)return Hovercards.isActive=!1,Hovercards.visibilityHandler.hideAllHovercards()}),$(document).on("mouseenter","a[data-uid]",function(){if($(this).closest(".drop").length)return!1;if(Hovercards.isActive=!0,null!==Hovercards.outTimeout&&clearTimeout(Hovercards.outTimeout),$(this).hasClass("drop-enabled"))return!1;var a=this;Hovercards.inTimeout=setTimeout(function(){var b=$(a);Hovercards.counter++,Hovercards.uid=b.attr("data-uid"),Hovercards.visibilityHandler.hideAllHovercards();var c,d=Hovercards.usersHandler.getCurrentUser();if(b.data("hovercard",Hovercards.counter),!Hovercards.exists(d)){var e=[];$("[data-uid]").each(function(){var a=$(this).attr("data-uid"),b=parseInt(a);if($.isNumeric(a)&&0<a&&0>e.indexOf(b)&&!Hovercards.exists(Hovercards.usersCache[b]))return e.push(b)}),c=$.ajax("xmlhttp.php",{data:{action:"hovercards",uids:e}})}$.when(c).then(function(b){Hovercards.exists(b)&&$.each(b,function(a,b){return Hovercards.usersHandler.saveUserInCache(b)}),$.when(Hovercards.colorHandler.getDominantColor()).then(function(){return Hovercards.visibilityHandler.showHovercard(a,Hovercards.buildTemplate())})})},1e3*Hovercards.delays.appear)}).on("mouseenter",".drop-element",function(){if(null!==Hovercards.outTimeout)return clearTimeout(Hovercards.outTimeout)}).on("mouseleave",".drop-element, *[data-uid]",function(a){var b=$(this).data("hovercard")?$(this).data("hovercard"):Hovercards.counter;null!==Hovercards.inTimeout&&clearTimeout(Hovercards.inTimeout),Hovercards.outTimeout=setTimeout(function(){var c=a.relatedTarget?$(a.relatedTarget):$(a.toElement),d=c.attr("class");return!(Hovercards.exists(c)&&(Hovercards.exists(d)&&d.match(/\b(drop-element|drop-target)\b/)||0<c.parents(".drop-element, .drop-target").length))&&Hovercards.visibilityHandler.hideHovercard(b)},1e3*Hovercards.delays.disappear)}))},buildTemplate:function(){var a=Hovercards.usersHandler.getCurrentUser();if(!a)return!1;var b=Hovercards.template;return $.each(a,function(a,c){$.isNumeric(c)&&10==c.length&&(c=Hovercards.utilities.processDateline(c,a)),b=b.replace(new RegExp("{"+a+"}","g"),c)}),b},visibilityHandler:{showHovercard:function(a,b){if(!Hovercards.isActive||parseInt($(a).data("hovercard"))!=Hovercards.counter)return!1;var c=Hovercards.counter;$(a).removeClass(function(a,b){return(b.match(/(^|\s)drop-number-\S+/g)||[]).join(" ")}),Hovercards.drops[c]=new Drop({target:a,content:b,position:Hovercards.options.dropPosition,classes:"drop-theme-hubspot-popovers drop-number-"+Hovercards.counter,openOn:"always"});var d=Hovercards.options.backgroundColor?"#"+Hovercards.options.backgroundColor:Hovercards.usersHandler.getCurrentUserProperty("dominant");if(0>Hovercards.options.dropPosition.indexOf("center")){function a(a){let b=a.drop.getBoundingClientRect().width,c=a.target.getBoundingClientRect().left,d=$(window).width()-c,e=b>d?"right":"left";a.tether.attachment.left=e,a.tether.targetAttachment.left=e,a.position()}Hovercards.drops[c].on("open",()=>a(Hovercards.drops[c]))}if(Hovercards.drops[c].position(),Hovercards.drops[c].open(),$(".drop-number-"+c).data("hovercard",c),Hovercards.drops[c].tether.on("repositioned",function(){var a=$(this.element).hasClass("drop-target-attached-bottom")?"bottom":"top";if(a==this.hovercardsArrowPosition)return!1;this.hovercardsArrowPosition=a;var b=Hovercards.options.backgroundColor?"#"+Hovercards.options.backgroundColor:Hovercards.colorHandler.getNormalizedColor(Hovercards.usersHandler.getCurrentUserProperty("dominant"));return Hovercards.colorHandler.updateArrowColorAndPositioning(a,b,c)}),d){var e=Hovercards.colorHandler.getComplementaryTextColor(d),f=$(Hovercards.drops[c].content),g=Hovercards.options.backgroundColor?d:Hovercards.colorHandler.getNormalizedColor(d);f.css("background",g),f.css("color",e)}if(g){var h=$(Hovercards.drops[c].drop).hasClass("drop-target-attached-bottom")?"bottom":"top";Hovercards.drops[c].tether.hovercardsArrowPosition=h,Hovercards.colorHandler.updateArrowColorAndPositioning(h,g)}},hideAllHovercards:function(){if(Hovercards.inTimeout&&clearTimeout(Hovercards.inTimeout),Hovercards.drops)for(var a in Hovercards.drops)Hovercards.drops.hasOwnProperty(a)&&Hovercards.visibilityHandler.hideHovercard(a)},hideHovercard:function(a){var b=Hovercards.drops[a];if(!Hovercards.exists(b))return!1;b.close();var c=function(){if(Hovercards.exists(b.drop))try{b.destroy()}catch(a){}Hovercards.colorHandler.deleteArrowColorAndPositioning(a)};return $(b.drop).afterTransition(c),setTimeout(c,500),Hovercards.drops.splice(a,1)}},usersHandler:{saveUserInCache:function(a){return!!Hovercards.exists(a.uid)&&(Hovercards.usersCache[a.uid]=a,!0)},saveUserPropertyInCache:function(a,b){return!!Hovercards.exists(Hovercards.uid)&&(Hovercards.usersCache[Hovercards.uid][a]=b,!0)},deleteUserFromCache:function(a){return Hovercards.usersCache.splice(a,1)},getUser:function(a){return Hovercards.usersCache[a]?Hovercards.usersCache[a]:null},getUserProperty:function(a,b){var c=Hovercards.usersHandler.getCurrentUser();return Hovercards.exists(c)&&Hovercards.exists(c[b])?c[b]:null},getCurrentUser:function(){return Hovercards.usersHandler.getUser(Hovercards.uid)},getCurrentUserProperty:function(a){return Hovercards.usersHandler.getUserProperty(Hovercards.uid,a)}},colorHandler:{getDominantColor:function(){return $.Deferred(function(){var a=this,b=Hovercards.usersHandler.getCurrentUser();if(Hovercards.exists(b)&&!Hovercards.exists(b.dominant)&&Hovercards.exists(b.avatar)&&!Hovercards.options.backgroundColor){var c=new Image;c.crossOrigin="anonymous",c.src=-1<b.avatar.indexOf("http")?"https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&refresh=300&url="+encodeURIComponent(b.avatar):b.avatar,$(c).one("load",function(){var b=new ColorThief;return Hovercards.usersHandler.saveUserPropertyInCache("dominant",b.getColor(c)),a.resolve()})}else return a.resolve()})},getComplementaryTextColor:function(a){return 160<=(299*a[0]+587*a[1]+114*a[2])/1e3?"rgba(0,0,0,.66)":"#fff"},getNormalizedColor:function(a){return"rgb("+a.join(", ")+")"},updateArrowColorAndPositioning:function(a,b,c){return c?$("#drop-arrow-"+c).replaceWith($("<style type=\"text/css\" id=\"drop-arrow-"+c+"\">.drop-number-"+c+" .drop-content::before {border-"+a+"-color: "+b+"!important}</style>")):$("body").append($("<style type=\"text/css\" id=\"drop-arrow-"+Hovercards.counter+"\">.drop-number-"+Hovercards.counter+" .drop-content::before {border-"+a+"-color: "+b+"!important}</style>"))},deleteArrowColorAndPositioning:function(a){return $("#drop-arrow-"+a).remove()}},utilities:{isTouchDevice:function(){return"ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints},processDateline:function(a,b){if(!a||!Hovercards.exists(a))return!1;var c=new Date(1e3*a),d=new Date().setHours(0,0,0,0)/1e3;if(a>d-86400&&a<d)return"Yesterday";if(a>d){var e,f=Math.round((new Date-c)/1e3);return 900>f&&"lastactive"==b?"Online":(e=30>f?"Just now":60>f?f+" seconds ago":120>f?"A minute ago":3600>f?Math.floor(f/60)+" minutes ago":1==Math.floor(f/3600)?"1 hour ago":86400>f?Math.floor(f/3600)+" hours ago":"Today",e)}var g=c.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()],h=c.getUTCFullYear();return new Date().getUTCFullYear()!=h&&(g+=" "+h),g}},exists:function(a){return!!("undefined"!=typeof a&&null!=a&&a)}};